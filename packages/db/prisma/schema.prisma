// Prisma schema for the monitoring system
// Add Monitor and Job models as per requirements

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Monitor {
  id              String   @id @default(cuid())
  url             String
  method          String
  intervalSeconds Int
  nextRunAt       DateTime
  jobs            Job[]
}

model Job {
  id        String   @id @default(cuid())
  monitorId String
  type      String
  status    String   @default("pending")
  payload   Json
  runAt     DateTime
  createdAt DateTime @default(now())

  Monitor Monitor @relation(fields: [monitorId], references: [id])

  @@index([status, runAt])
}

model Delivery {
  id        String   @id @default(cuid())
  alertId   String
  type      String   // "email" or "webhook"
  target    String   // email address or webhook URL
  status    String   // "success" or "failed"
  message   String?
  error     String?
  attempt   Int      @default(1)
  createdAt DateTime @default(now())

  @@index([alertId])
  @@index([status])
  @@index([createdAt])
}
